//Declaracion de variables
var tabla = null, fila = null, objeto = null;
div = null, datos = [], tb = null;
var Columnas = new Object();

//definir boton
function definirbtn(valor) {
    if (valor == "") {
        Columnas["desplega"] = ' ';
    } else {
        Columnas[valor]='';
    }
}

//Contar las columnas de una tabla
function ContarColumnas() {
    var th = $("#tabla thead tr").find("th");
    for (var i = 0; i < th.length; i++) {
        definirbtn(th[i].innerText.split("\n").join("").trim(), i);
    }
}

//Preparar 
function prepararTabla() {
    ContarColumnas();
    var clases = [];
    var indice = 1;
    if (Columnas.desplega==undefined) {
        indice = 0;
    }
    $.each(Columnas, function (indice, valor) {        
        if (valor == ' ') {
            clases.push({ className: " details-control", "width": "70px", "orderable": false, "defaultContent": '' });
        } else if (indice == 'Acciones') {
            clases.push({ className: " details", "orderable": false, "defaultContent": '' });
        } else {
            clases.push(null);
        }
    });    
    tabla = $('#tabla').DataTable({
        "columns": clases,
        "order": [[indice, 'asc']]
    });
    $('#tabla').parents('div.dataTables_wrapper').first().hide();
}
function llenarTable(ActionResult) {
    $('#tabla').parents('div.dataTables_wrapper').first().hide();
    var msj;
    $("#msj").show();
    $.ajax({
        url: DireccionURL + '/' + ActionResult,
        method: "GET",
        dataType: "json",
        contentType: "application/json; charset = utf-8"
    })
    .done(function (Lista) {
        if (Lista.length > 0) {
            Serializar(Lista);
            tabla.clear();
            tabla.draw();
            $.each(datos, function (i, obj) {
                var columnasBody = [];
                if (Columnas.btn0!=undefined) {
                    columnasBody.push('<input class="indice" type="button" name="' + i + '"  hidden/>');
                }
                addRow(i, obj);
                $.each(Columnas, function (index, value) {
                    columnasBody.push(value);
                });
                tabla.row.add(columnasBody).draw();
            });
            tabla.draw();
        } else {
            c = $(".dataTables_empty");
            c[0].innerHTML = '<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¡no se encoontraron registros!</font></font>';
            c[0].innerText = "¡no se encoontraron registros!";
            c.bind();
        }
        tabla.draw();
        $("#msj").hide();
        $('#tabla').parents('div.dataTables_wrapper').first().show();
    });
    //.error(function (jqXHR, textStatus, errorThrown) {
    //    if (jqXHR.responseText=="") {
    //        tabla.clear();
    //        tabla.draw();
    //        c = $(".dataTables_empty");
    //        c[0].innerHTML = '<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¡Problemas al conectar con el servidor! estamos trabajando para solucionarlo... disculpe las molestias.</font></font>';
    //        c[0].innerText = "¡Problemas al conectar con la base de datos! estamos trabajando para solucionarlo... disculpe las molestias.";
    //        c.bind();
    //        $("#msj").hide();
    //        $('#tabla').parents('div.dataTables_wrapper').first().show();
    //    }        
    //});
}
function Serializar(ServerData) {
    EstructuraDatos();
    var objeto = null;
    $.each(ServerData, function (index, value) {
        $.each(value, function (indice, valor) {
            objeto = $.parseJSON(valor)[0];
            if (objeto == undefined) {
                objeto = JSON.parse(valor);
            }
            Datos[indice] = objeto;
        });
        datos.push(Datos);
        EstructuraDatos();
    });
}
function IsNull(Texto) {
    if (Texto == undefined) {
        return "";
    } else {
        return Texto;
    }
}
function cargarObjetos() {
    AgregarModales();
    CrearModal(tb);    
}